% plots contrasts on 3d circles at scalp

contrast = 'con_0001_TVALS.mat'; % name of your contrast to plot
load(contrast);

% get some info for colormap
min_t = min(TVALS_LIST(TVALS_LIST>0));
max_t = max(TVALS_LIST);
per_t = min_t/max_t;
byte_t = ceil(per_t*255);
t_trans = [0 byte_t 255-byte_t 255];
t_colors = [0 0 0; 1 0 0; 1 1 0; 1 1 1];
cmap = interp1(         


% surfaces from spm
spm_dir = fullfile(spm('dir'),'canonical');
scalp = gifti(fullfile(spm_dir, 'scalp_2562.surf.gii'));
cortex = gifti(fullfile(spm_dir,'cortex_20484.surf.gii'));

% braincolor = [240 175 105]./255; % looks more like a cadaver brain
braincolor = [200 120 105]./255; % pinker look

% channel and optode locations
[hline,lbl,pos] = nirx_read_chpos('optode_positions.csv');
chpairs = nirx_read_chconfig('ch_config.txt');
chpos = nirx_compute_chanlocs(lbl,pos,chpairs);
sind = [];
dind = [];
for ii=1:length(lbl)
    if lbl{ii}{1}(1)=='S'
        sind = [sind ii];
    end
end
dind = setdiff(1:length(lbl),sind);

% plot surfaces
figure('color','white');
plotted_vertices = scalp.vertices;
plotted_vertices(:,3) = plotted_vertices(:,3) - 10;
s = patch('vertices',plotted_vertices,'faces',scalp.faces,'edgecolor','none',...
        'facecolor',[.8 .8 .8]);
s.FaceLighting = 'gouraud';
alpha(s,.4);
axis image off; hold on; 
c = patch('vertices',cortex.vertices,'faces',cortex.faces,'edgecolor','none',...
        'facecolor',braincolor);
c.FaceLighting = 'gouraud';
camlight left;
%lighting gouraud;
rotate3d on;

% get surface normals
N = patchnormals(scalp);

% set face alphas
fa = zeros(1,length(scalp.vertices));
ind = find(TVALS_LIST);
fa(ind) = 1;

% plot
nirx_plot_optode3d(chpos,scalp.vertices,N, 'edgecolor',[0 0 1],'facecolor',[1 0 0],...
    'facealpha',fa);